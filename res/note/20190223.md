# 20190219
## Fuck the JavaScript
### varとlet
今までなんとなく関数スコープのvarを使っていたがブロックスコープletに変えた。
[参考](https://qiita.com/y-temp4/items/289686fbdde896d22b5e)。
その関係で、二度宣言されていたrが発覚した。

そのついでに``'use strict';``を設定してみたら数件バグを発見。
let書き換えの際に他にバグを産んでないか不安だったし。
ただし、上のようなletの二重定義は発見できない。

##### 雑記
関数スコープってなんだよ。
普段まともな言語(Perlは除く)を使っているせいでそんなスコープだとは思わなかった。
Perlも大概だけど、適当にしか使ってないからな。

でもサーバーで``sudo nano``すると即反映するのは楽しい。
TypeScriptとか使わないのもそういう理由ね。
挙句いろいろ汚くなる。

### for(let item of list){}
最初は``for(var key in list){}``しか知らなかったからofに書き換えた。
inも便利な場合もあるが、配列の場合いちいちparseIntしないといけないという。

## UI解説
最初に「全画面」が出てくるのはユーザーが操作しないと全画面にできないから。
スマホ向けの機能です。
ついでに最近ランドスケープをデフォにしました。できないと思ってた。

文字はデフォルトでは小さめに設定してある。
ニコニコ動画は2006年とかが開始でそれ以降文字サイズは変えてないはず。
スマホもフルHDが最低限くらいになった現在ではちょっと大きすぎる。
と言うわけで個人的好みで小さめにしている。

コマンド``ender``が含まれている場合は、大きめの標準サイズにしている。
``ender``はコメントアートとかに使われるので。

コントローラーを画面中央下に置いてるのは以下の理由から。

* 画面下は通常標準のビデオコントローラーが置いてある。
  * 普通のビデオ機能も独自UIにしても良かったけれども、標準UIはバージョン更新で機能向上するやブラウザ毎の違いもある。
* 画面中央は再生ボタンがある。
* 暫くはビデオの下に文字で置いて停止中だけ表示とかでかなり不便だった。場所移動してアイコンにしたのは最近。
* その前は画面左上にしていたのだが、スマホだとアドレスバーとかに誤タップされてしまうし、コメントが被る。
* 画面中央上でも割といいけど、どちらかと言えば中央下の方がしっくりくる。コメントも少ない。

コメントの取得設定で、コメントは大盛り目にしてあるはず。
PV動画とかすごい数になる。
これも個人的好みで賑やかな方が楽しいから。

後、コメントにシャドウを付けているが、これはその方がカッコいいから。
使っているデバイスは全て余裕で描画できているので問題ない。

## commentproxy.cgi
コメント取得はプロキシを立てているのだが、理由は以下。

* 最初にPerlで書いたから今はその方が楽。
* ~~どうせサーバーには取得用ニコニコ動画アカウントが必要。~~
* ~~ブラウザで取得するなら少なくともログインしていないといけない。~~
* そもそもブラウザのJavaScriptでは取得できない。クロスオリジンだから。

コメントの書き込み機能を入れないのは以下。

* めんどくさい。
* 公式ではないビュワーで書き込みをすべきでない。
  * 公式では見えないコメントが見えていたり、コメントアートが崩れたりするはず。
* コメントを書き込みたいなら公式で見るべし。
* 視聴期間外に書き込みできるのもどうなのか。
* サーバーから書き込んだ場合、書き込みアカウントが全てサーバーのものになる。
