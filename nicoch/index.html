<html>
  <head>
    <title>ニコニコチャンネルレコーダー</title>
    <link rel="stylesheet" type="text/css" href="default.css" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, user-scalable=yes,initial-scale=1.0" />
    <!-- icon info -->
    <link rel="shortcut icon" type="image/vnd.microsoft.icon" href="favicons/favicon.ico" />
    <link rel="icon" type="image/vnd.microsoft.icon" href="favicons/favicon.ico" />
    <link rel="apple-touch-icon" sizes="57x57" href="favicons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="favicons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="favicons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="favicons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="favicons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="favicons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="favicons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="favicons/apple-touch-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon-180x180.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="favicons/android-chrome-192x192.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="favicons/favicon-48x48.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="favicons/favicon-96x96.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="favicons/favicon-160x160.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="favicons/favicon-196x196.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png" />
    <link rel="manifest" href="favicons/manifest.json" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="msapplication-TileImage" content="favicons/mstile-144x144.png" />
    <!-- end of icon info -->
  </head>
  <body>
    <h1>録画済み動画</h1>
    <div class='channel_group' id="container_channel_recorded"></div>
    <h1>録画予約</h1>
    <div class="form_add">
      <form action="modify.cgi" method="post">
        <input type="input" name="a1" value="http://ch.nicovideo.jp/..." />
        <input type="hidden" name="op" value="add" />
        <input type="submit" value="追加" />
      </form>
      <br />
      <a href="http://ch.nicovideo.jp">ニコニコチャンネル</a>
      <a href="editor.cgi">一括編集</a>
      <a href="tv.html">テレビ向けUI</a>
    </div>
    <h1>録画予約中のチャンネル</h1>
    <div class='channel_group' id="container_channel_recording">
    </div>
    <script type="text/javascript"> 
//<[CDATA[
var Channels;
var LastChannel=localStorage.getItem("niconico_last_played_channel")?localStorage.getItem("niconico_last_played_channel"):null;
GetData(function(){ShowChannels()});

function ShowChannels(){
  ShowChannelsRecorded();
  ShowChannelsRecording();
}

function ShowChannelsRecorded(){
  var container_ch = document.getElementById("container_channel_recorded");
  ClearChild(container_ch);
 
  var recorded=Channels["recorded_channels"];
 
  var scrollTarget=null;
  for(var item in recorded){
    var div=AppendChannelBoxRecorded(container_ch,recorded[item]);
    if(LastChannel!=null && recorded[item].channel_id == LastChannel){
      scrollTarget=div;
    }
  }

  if(scrollTarget!=null){
    ScrollInto(scrollTarget);
  }
}

function AppendChannelBoxRecorded(container,item){
  var div=document.createElement("div");
  div.setAttribute("class","channel_box");
  div.innerHTML="<iframe class='channel_thumb' scrolling='no' src='http://ch.nicovideo.jp/"+item["channel_id"]+"/thumb_channel'></iframe>";
  AppendVideoGroup(div,item);
  container.appendChild(div);
  return div;
}

function ScrollInto(item){
  item.scrollIntoView({
    behavior: 'smooth',
    block: 'start',
    inline: 'nearest',});
}

function OpenVideo(movie_id,channel_id){
  localStorage.setItem("niconico_last_played_channel",channel_id);
  window.location.href = "http://www.nicovideo.jp/watch/"+video_id;
  return false;
}

function ShowChannelsRecording(){
  var container_ch = document.getElementById("container_channel_recording");
  ClearChild(container_ch);

  var recording=Channels["recording_channels"];

  for(var item in recording){
    AppendChannelBoxRecording(container_ch,recording[item]);
  }
}

function AppendChannelBoxRecording(container,item){
  var div=document.createElement("div");
  div.setAttribute("class","channel_box");
  div.innerHTML="<iframe class='channel_thumb' scrolling='no' src='http://ch.nicovideo.jp/"+item["channel_id"]+"/thumb_channel'></iframe>"
    +"<form action='modify.cgi' method='post'><input type='hidden' name='a1' value='https://ch.nicovideo.jp/"+item["channel_id"]+"' /><input type='hidden' name='op' value='del' /><input class='delete' type='submit' value='削除' /></form>";
  container.appendChild(div);
}

function AppendVideoGroup(container,item){
  var div=document.createElement("div");
  div.setAttribute("class","video_group");
  var html="";
  var videos=item.videos;
  for(var key in videos){
    var video=videos[key];
    html+="<a href='"+video.player_url+"' onclick='OpenVideo(\""+video.id+"\",\""+item.channel_id+"\")'>"+video.title+"</a>(<a href='http://www.nicovideo.jp/watch/"+video.id+"'>org</a>)<br />";
  }
  div.innerHTML=html;
  container.appendChild(div);
}

function ClearChild(container){
  while(container.hasChildNodes()){container.removeChild(container.lastChild);}
}

function GetData(callback){
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function()
  {
    if( this.readyState == 4 && this.status == 200 )
    {
      Channels = this.response;
      callback();
    }
  }

  xhr.open( 'GET', 'api.cgi', true );
  xhr.responseType = 'json';
  xhr.send( null );
}
//]]>
    </script>
  </body>
</html>
  
